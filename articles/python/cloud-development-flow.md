---
title: Azure 開発フロー
description: プロビジョニング、コーディング、テスト、デプロイ、管理を伴う Azure でのクラウド開発サイクルの概要。
ms.date: 06/04/2020
ms.topic: conceptual
ms.openlocfilehash: 644cafc60619a1920e256c4c4f32f1b3308caa83
ms.sourcegitcommit: 499f7275446f006fa43c4eff3b1f0d001e9a98d9
ms.contentlocale: ja-JP
ms.lasthandoff: 06/05/2020
ms.locfileid: "84453743"
---
# <a name="the-azure-development-flow-provision-code-test-deploy-and-manage"></a>Azure の開発フロー: プロビジョニング、コーディング、テスト、デプロイ、管理

[前回の記事: リソースのプロビジョニング、アクセス、管理](cloud-development-provisioning.md)

Azure のサービスとリソースのモデルを理解したら、**プロビジョニング**、**コーディング**、**テスト**、**デプロイ**、**管理**という、Azure を使用したクラウド アプリケーションの全体的な開発フローを理解することができます。

| 手順 | 主要ツール | Activities |
| --- | --- | --- |
| プロビジョニング | Azure 管理ライブラリを使用する Azure CLI、Azure Portal、Cloud Shell、Python スクリプト | リソース グループをプロビジョニングします。それらのグループで特定のリソースをプロビジョニングします。アプリ コードから使用できるように、また、デプロイで Python コードを受け取れるようにリソースを構成します。 |
| コード | コード エディター (Visual Studio Code など)、Azure ライブラリ、参照ドキュメント | プロビジョニングされたリソースとやりとりするよう、Azure クライアント ライブラリを利用して Python コードを記述します。 |
| テスト | Python ランタイム、デバッガー | アクティブなクラウド リソース (通常、運用リソースではなく、開発またはテスト リソース) に対して Python コードをローカルで実行します。 コード自体は Azure でまだホストされていないため、デバッグや反復処理を素早く行うことができます。 |
| 配置 | Azure CLI、GitHub、DevOps | コードがローカルでテストされたら、コード自体をクラウドで実行できる適切な Azure ホスティング サービスにそれをデプロイします。 デプロイされたコードは通常、ステージングまたは運用リソースに対して実行されます。 |
| 管理する | Azure CLI、Azure Portal、Python スクリプト、Azure Monitor | アプリのパフォーマンスと応答性を監視し、運用環境で調整を行い、次回のプロビジョニングと開発のために開発環境に改良点を移行します。 |

## <a name="step-1-provision-and-configure-resources"></a>手順 1:リソースのプロビジョニングと構成を行う

[このシリーズにおける前回の記事](cloud-development-provisioning.md)で説明したように、アプリケーション開発の最初のステップは、アプリケーションのターゲット環境を成り立たせるリソースのプロビジョニングと構成です。

プロビジョニングではまず、適切な Azure リージョンにリソース グループを作成します。 リソース グループの作成は、Azure portal や Azure CLI から行えるほか、Azure ライブラリ (または REST API) を使用するカスタム スクリプトで行うことができます。

そのリソース グループ内で、ここでもポータル、CLI、または Azure ライブラリを使用して、必要な個々のリソースをプロビジョニングして構成します。 構成には、どの ID (サービス プリンシパルまたはアプリケーション ID) がそれらのリソースにアクセスできるかを制御するアクセス ポリシーの設定が含まれます。

ほとんどのアプリケーション シナリオでは、Azure CLI と Python コードまたはそのいずれかで、Azure ライブラリを使用してプロビジョニング スクリプトを作成することになります。 このようなスクリプトによって、アプリケーションのリソース ニーズの全体性が説明されます。 スクリプトによって、Azure portal でさまざまな手順を主導で繰り返すことなく、異なる開発環境、テスト環境、ステージング環境、運用環境内で同じリソース セットを簡単に再作成できます。 そのようなスクリプトがあれば、別のリージョンに環境をプロビジョニングしたり、異なるリソース グループを使用したりすることも簡単にできます。 さらに、完全な監査と変更履歴が得られるよう、それらのスクリプトはソース管理リポジトリで保守することができます。

## <a name="step-2-write-your-app-code-to-use-resources"></a>手順 2:リソースを使用するアプリ コードを作成する

アプリケーションに必要なリソースをプロビジョニングしたら、それらのリソース (コード自体のデプロイ先となるリソースを除く) と連動するアプリケーション コードを作成します。

たとえばプロビジョニング手順で、Azure Storage アカウントを作成し、そのアカウントに BLOB コンテナーを作成して、そのコンテナー上のアプリケーションのアクセス ポリシーを設定したとします。 今度は、自分のコードから、そのストレージ アカウントに対する認証を行った後、そのコンテナー内の BLOB を作成、更新、削除することができます (このプロセスについては、[Azure Storage の使用例](azure-sdk-example-storage.md)に関するページでデモンストレーションを行っています)。同様に、スキーマと適切なアクセス許可を使用してデータベースをプロビジョニングしたとすれば、アプリケーション コードから、そのデータベースに接続して、通常の操作 (作成、読み取り、更新、削除) を実行することができます。

アプリ コードでは通常、使用するリソースの名前と URL を特定する目的で環境変数が使用されます。 環境変数によって、コードを変更することなく、クラウド環境 (開発、テスト、ステージング、運用) を簡単に切り替えることができます。

Python 開発者であればおそらく、Python 用 Azure ライブラリを使用して Python でアプリケーション コードを作成します。 とはいえ、クラウド アプリケーションを構成する独立したパーツは、サポートされている任意の言語で作成できます。 たとえば、言語の得意分野に多様性があるチームで作業している場合、アプリケーションの領域ごとに Python、JavaScript、Java、C# などを使い分けることも十分可能です。

アプリケーション コードは、必要に応じて、Azure ライブラリを使用してプロビジョニングと管理の操作を実行できることに注意してください。 同様に、プロビジョニング スクリプトは、ライブラリを使用して特定のデータでリソースを初期化したり、それらのスクリプトがローカルで実行されている場合でも、クラウド リソースに対してハウスキーピング タスクを実行したりできます。

## <a name="step-3-test-and-debug-your-app-code-locally"></a>手順 3:アプリ コードのテストとデバッグをローカルで行う

一般に開発者は、アプリのコードを各自のローカル ワークステーションでテストしてから、クラウドにデプロイしたいと考えます。アプリのコードをローカルでテストするとは、通常、既にクラウドにプロビジョニングしてある他のリソース (ストレージ、データベースなど) にアクセスすることを意味します。 違いは、アプリのコード自体がまだクラウド サービス内で実行されていないだけです。

また、コードをローカルで実行することにより、Visual Studio Code などのツールに備わっているデバッグ機能を最大限に活用すると共に、ソース管理リポジトリで自分のコードを管理することができます。

ローカル テストのために、コードを変更する必要は一切ありません。Azure では、クラウドにデプロイするものと同じコードを使用して、すべての開発とデバッグをローカルで行うことができます。 ここでも鍵となるのが環境変数です。クラウドでは、ホスティング リソースの設定を環境変数としてコードから利用することができます。 同じ環境変数をローカルにも作成することにより、同じコードが変更なしに動作します。 このパターンは、認証の資格情報、リソースの URL、接続文字列など、さまざまな設定で役立ちます。コードをローカルで実行するときには開発環境のリソースを、また、コードがクラウドにデプロイされた後は運用環境のリソースを簡単に使用できるようになります。

## <a name="step-4-deploy-your-app-code-to-azure"></a>手順 4:アプリのコードを Azure にデプロイする

コードをローカルでテストしたら、いよいよ、そのホストとなるプロビジョニング済みの Azure リソースにコードをデプロイすることになります。 たとえば、Django Web アプリケーションを作成している場合、そのコードを仮想マシン (この場合は独自の Web サーバーを用意) または Azure App Service (最初から Web サーバーが用意されている) にデプロイします。 デプロイされたコードは、ローカル コンピューター上ではなくサーバー上で実行され、承認されたあらゆる Azure リソースにアクセスすることができます。

前のセクションで触れたように、通常の開発プロセスでは、まず、開発環境のプロビジョニング済みリソースにコードをデプロイします。 何度かテストを重ねた後、ステージング環境のリソースにコードをデプロイします。アプリケーションはテスト チームに公開されます。そこにはプレビュー ユーザーも含まれるかもしれません。 アプリケーションのパフォーマンスに問題がなければ、運用環境にコードをデプロイすることができます。 これらのデプロイはすべて、Azure DevOps を使用した継続的インテグレーションと継続的デプロイを通じて自動化することもできます。

どのような方法で行うにせよ、クラウドにデプロイしたコードは、紛れもなくクラウド アプリケーションとなり、完全に Azure のデータ センター内のサーバー コンピューター上で実行されます。

## <a name="step-5-manage-monitor-and-revise"></a>手順 5:管理、監視、修正する

デプロイ後は、アプリケーションが意図したとおりに動作して、ユーザーからの要求に応答し、リソースを効率よく (かつ最小限のコストで) 使用していることを確認する必要があります。 必要に応じて Azure がデプロイを自動的にスケーリングする方法を管理できるほか、Azure portal または Azure CLI を使用して、あるいは Azure ライブラリを使って作成されたカスタム スクリプトを使用して、パフォーマンス データを収集して監視することもできます。 その後、再び同じツールをどれでも使用して、プロビジョニング済みのリソースをリアルタイムで調整し、パフォーマンスを最適化することができます。

クラウド アプリケーションを再構築する方法についての分析情報は、監視によって得られます。 たとえば、Web アプリの特定の部分 (一連の API エンドポイントなど) が、主な部分と比較してまれにしか使用されていないと判明する場合があります。 その場合は、それらの API を切り離してサーバーレスの Azure Functions としてデプロイすれば、メインのアプリケーションと競合せず、それでいて毎月のコストも少額で済む専用のバッキング コンピューティング リソースを利用することができます。 高額の価格レベルにスケールアップすることなく、メイン アプリケーションで処理できるユーザー数を増やし、応答性を高めることができます。

## <a name="next-steps"></a>次のステップ

以上、Azure の基本的な構造と全体的な開発フローについて説明しました。リソースのプロビジョニング、コードの作成とテスト、Azure へのコードのデプロイ、それらのリソースの監視と管理についてご理解いただけかと思います。

次の手順は、フローのさまざまな部分で使用することになる、Python 用の Azure ライブラリについて詳しくなることです。

> [!div class="nextstepaction"]
> [Python 用 Azure ライブラリの詳細を見る >>>](azure-sdk-overview.md)
